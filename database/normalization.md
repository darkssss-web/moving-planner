# Нормализация базы данных Moving-Planner

Документ описывает процесс нормализации структуры данных приложения Moving-Planner.  
Цель нормализации — уменьшить избыточность, устранить аномалии обновления и обеспечить логическую целостность данных.

---

## 1. Предметная область

Moving-Planner — приложение для планирования переезда.  
Основные объекты:

- **Пользователь** — владелец всех данных.
- **Комната** — целевое помещение в новой квартире (кухня, спальня, гостиная и т.п.).
- **Коробка** — контейнер для вещей, привязанный к комнате.
- **Вещь** — объект, который нужно перевезти.
- **Задача** — действие, связанное с процессом переезда.
- **Статус задачи** — состояние задачи (запланирована, в процессе, выполнена).

---

## 2. Денормализованный вариант (логика исходной структуры)

Если пытаться хранить все данные в одной таблице `MoveLog`, в ней могли бы оказаться поля:

- информация о пользователе,
- название комнаты,
- описание коробки,
- данные вещи,
- текст задачи и её статус.

Пример условного набора атрибутов:

`MoveLog(user_name, room_name, box_label, item_name, item_description, task_title, status_name, ...)`

Такая структура приводит к:

- многократному дублированию одинаковых значений (статусы, комнаты, коробки, пользователь);
- аномалиям вставки (нельзя описать комнату без вещей/задач),
- аномалиям обновления (изменение имени комнаты требует редактировать множество строк),
- аномалиям удаления (удаление последней вещи в комнате может удалить и саму комнату).

---

## 3. Приведение к первой нормальной форме (1NF)

Требования 1NF:

- каждое поле содержит атомарное значение;
- нет повторяющихся групп столбцов;
- каждая строка однозначно идентифицируется первичным ключом.

Применительно к Moving-Planner:

- выделены отдельные сущности в самостоятельные таблицы:
  - `Users` — данные пользователей;
  - `Rooms` — комнаты;
  - `Boxes` — коробки;
  - `Items` — вещи;
  - `Statuses` — справочник статусов задач;
  - `Tasks` — задачи по переезду;
- каждая таблица имеет свой первичный ключ (user_id, room_id, box_id, item_id, status_id, task_id);
- в таблицах отсутствуют списки значений внутри одного поля.

Таким образом, схема удовлетворяет требованиям первой нормальной формы.

---

## 4. Приведение ко второй нормальной форме (2NF)

Условие 2NF:

- для таблиц с составным первичным ключом не должно быть частичных зависимостей;
- неключевые атрибуты должны зависеть от **всего** ключа, а не от его части.

В разработанной схеме:

- все основные таблицы (`Users`, `Rooms`, `Boxes`, `Items`, `Statuses`, `Tasks`) имеют **простые** первичные ключи;
- неключевые атрибуты зависят только от одного идентификатора (например, данные комнаты — только от `room_id`);
- таблиц с составным первичным ключом нет, следовательно отсутствуют частичные зависимости.

Текущая структура находится как минимум во второй нормальной форме.

---

## 5. Приведение к третьей нормальной форме (3NF)

Условия 3NF:

- отсутствуют транзитивные зависимости;
- каждый неключевой атрибут зависит только от первичного ключа своей таблицы.

Применение к модели Moving-Planner:

- данные о пользователе (`username`, `email`) зависят только от `user_id` и хранятся в таблице `Users`;
- данные о комнате (`name`, `description`) зависят только от `room_id` и находятся в `Rooms`;
- данные о коробке (`label`, `notes`) зависят только от `box_id` и находятся в `Boxes`;
- данные о вещи (`name`, `description`, `is_fragile`, `value_estimate`) зависят только от `item_id` и хранятся в `Items`;
- статусы задач (`name`) выделены в отдельную таблицу `Statuses`, в таблице `Tasks` используется только внешний ключ `status_id`;
- задачи (`title`, `description`, `due_date`) зависят только от `task_id` и связаны с пользователем и статусом через внешние ключи.

Все неключевые атрибуты зависят непосредственно от первичных ключей своих таблиц, транзитивные зависимости отсутствуют — схема удовлетворяет требованиям третьей нормальной формы.

---

## 6. Итоговая нормализованная схема

### Users
- хранит данные пользователей системы;
- первичный ключ: `user_id`.

### Rooms
- содержит список комнат, принадлежащих пользователю;
- внешний ключ: `user_id → Users.user_id`.

### Boxes
- описывает коробки, привязанные к комнатам;
- внешний ключ: `room_id → Rooms.room_id`.

### Items
- хранит сведения о вещах, размещённых в коробках;
- внешний ключ: `box_id → Boxes.box_id`.

### Statuses
- справочник возможных состояний задач;
- первичный ключ: `status_id`.

### Tasks
- задачи по переезду, привязанные к пользователю и статусу;
- внешние ключи: `user_id → Users.user_id`, `status_id → Statuses.status_id`.

Связи между таблицами образуют иерархию:

`User → Room → Box → Item`  
и  
`User → Task → Status`

что удобно для обработки данных и не создаёт лишних циклов зависимостей.

---

## 7. Вывод

База данных Moving-Planner:

- приведена к 1NF, 2NF и 3NF;
- избавлена от избыточности и транзитивных зависимостей;
- обеспечивает логическую целостность данных при работе с пользователями, комнатами, коробками, вещами и задачами;
- готова к использованию в приложении и дальнейшему развитию.
